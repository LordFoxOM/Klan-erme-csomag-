javascript:(function(){ if(!window.location.href.includes("screen=overview_villages&mode=prod")){     window.location.href=window.location.origin+"/game.php?screen=overview_villages&mode=prod%22;%20%20%20%20%20return;%20}%20let%20sentPackages=0;%20let%20coordinate=%22%22;%20let%20pkgWood=0,pkgClay=0,pkgIron=0,maxPackages=0;%20let%20selectedGroupId=null;%20let%20allGroups=[];%20let%20scriptStarted=false;%20let%20usedVillageIds=new%20Set();%20const%20panel=document.createElement(%22div%22);%20panel.style=%22position:fixed;top:100px;left:100px;z-index:9999;background:#f4e4bc;color:#000;padding:10px;border:2px%20solid%20#804000;width:460px;resize:both;overflow:auto;font-family:Verdana,sans-serif;font-size:13px;border-radius:8px;box-shadow:0%200%2010px%20#000;%22;%20panel.innerHTML=%60%3Cdiv%20style='text-align:right'%3E%3Cbutton%20id='closePanel'%20style='background:#804000;color:white;border:none;padding:2px%206px;border-radius:4px;cursor:pointer'%3EX%3C/button%3E%3C/div%3E%3Cb%20style='font-size:15px'%3E%F0%9F%93%A6%20Csomag%20K%C3%BCld%C5%91%3C/b%3E%3Ctable%20style='width:100%;margin-top:5px'%3E%3Ctr%3E%3Ctd%3E%3Cb%3EC%C3%A9l%20koordin%C3%A1ta:%3C/b%3E%3C/td%3E%3Ctd%3E%3Cinput%20id='coordInput'%20type='text'%20value=''%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%3E%3Cb%3E%3Cimg%20src='https://dshu.innogamescdn.com/asset/7d3266bc/graphic/holz.webp'%20height=15%3E%201%20csomag%20fa:%3C/b%3E%3C/td%3E%3Ctd%3E%3Cinput%20id='woodInput'%20type='number'%20value='2800'%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%3E%3Cb%3E%3Cimg%20src='https://dshu.innogamescdn.com/asset/7d3266bc/graphic/lehm.webp'%20height=15%3E%201%20csomag%20agyag:%3C/b%3E%3C/td%3E%3Ctd%3E%3Cinput%20id='clayInput'%20type='number'%20value='3000'%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%3E%3Cb%3E%3Cimg%20src='https://dshu.innogamescdn.com/asset/7d3266bc/graphic/eisen.webp'%20height=15%3E%201%20csomag%20vas:%3C/b%3E%3C/td%3E%3Ctd%3E%3Cinput%20id='ironInput'%20type='number'%20value='2500'%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%3E%3Cb%3EMax%20csomagsz%C3%A1m:%3C/b%3E%3C/td%3E%3Ctd%3E%3Cinput%20id='maxInput'%20type='number'%20value='10'%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%3E%3Cb%3EFalu%20csoport:%3C/b%3E%3C/td%3E%3Ctd%3E%3Cselect%20id='groupSelector'%3E%3C/select%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%20colspan='2'%3E%3Cbutton%20id='startScript'%20class='btn'%3EInd%C3%ADt%C3%A1s%3C/button%3E%3C/td%3E%3C/tr%3E%3Ctr%3E%3Ctd%3E%3Cb%3EEddig%20Elk%C3%BCld%C3%B6tt%20Csomagok:%3C/b%3E%3C/td%3E%3Ctd%20id='sentCounter'%3E0%3C/td%3E%3C/tr%3E%3C/table%3E%3Cdiv%20id='villList'%20style='max-height:400px;overflow-y:auto;margin-top:10px;border-top:1px%20solid%20#ccc;padding-top:5px'%3ECsoport%20kiv%C3%A1lasztva.%20Kattints%20az%20Ind%C3%ADt%C3%A1sra!%3C/div%3E%3Cdiv%20style='text-align:center;font-size:11px;color:#555;margin-top:8px'%3EBy%20%3Cb%3ELordFox%3C/b%3E%3C/div%3E%60;%20document.body.appendChild(panel);%20document.getElementById('closePanel').onclick=()=%3Epanel.remove();%20panel.onmousedown=function(e){if([%22INPUT%22,%22BUTTON%22,%22SELECT%22].includes(e.target.tagName))return;let%20offsetX=e.clientX-panel.getBoundingClientRect().left;let%20offsetY=e.clientY-panel.getBoundingClientRect().top;function%20move(e){panel.style.left=e.pageX-offsetX+'px';panel.style.top=e.pageY-offsetY+'px';}document.addEventListener('mousemove',move);panel.onmouseup=function(){document.removeEventListener('mousemove',move);};};%20panel.ondragstart=()=%3Efalse;%20function%20fetchGroups(callback){const%20links=document.querySelectorAll('.group-menu-item');allGroups=Array.from(links).map(link=%3E({id:link.dataset.groupId,name:link.textContent.replace(/[\[\]%3E]/g,'').trim(),selected:link.classList.contains('selected')||link.parentElement.tagName==='STRONG'}));const%20select=document.getElementById(%22groupSelector%22);select.innerHTML=allGroups.map(g=%3E%60%3Coption%20value='${g.id}'%20${g.selected?%22selected%22:%22%22}%3E${g.name}%3C/option%3E%60).join(%22%22);selectedGroupId=select.value;select.onchange=function(){selectedGroupId=select.value;if(scriptStarted){document.getElementById(%22villList%22).innerHTML=%22Friss%C3%ADt%C3%A9s...%22;setTimeout(()=%3EloadVillages(),100);}else{document.getElementById(%22villList%22).innerHTML=%22Csoport%20kiv%C3%A1lasztva.%20Kattints%20az%20Ind%C3%ADt%C3%A1sra!%22;}};if(callback)callback();}%20document.getElementById(%22startScript%22).onclick=function(){coordinate=document.getElementById('coordInput').value;if(!coordinate||!coordinate.match(/\d+\|\d+/))return%20alert(%22%C3%89rv%C3%A9nytelen%20koordin%C3%A1ta!%22);pkgWood=parseInt(document.getElementById('woodInput').value);pkgClay=parseInt(document.getElementById('clayInput').value);pkgIron=parseInt(document.getElementById('ironInput').value);maxPackages=parseInt(document.getElementById('maxInput').value);sentPackages=0;usedVillageIds.clear();scriptStarted=true;document.getElementById('sentCounter').innerText=sentPackages;if([pkgWood,pkgClay,pkgIron,maxPackages].some(isNaN))return%20alert(%22Hib%C3%A1s%20%C3%A9rt%C3%A9k%20valamelyik%20mez%C5%91ben!%22);loadVillages();};%20function%20loadVillages(){%20const[targetX,targetY]=coordinate.split('|').map(Number);%20$.get(%60/game.php?screen=overview_villages&mode=prod&group=${selectedGroupId}&page=-1%60,function(response){%20const%20parser=new%20DOMParser();%20const%20doc=parser.parseFromString(response,%22text/html%22);%20const%20rows=doc.querySelectorAll(%22#production_table%20tr.nowrap%22);%20const%20villageList=[];%20rows.forEach(row=%3E{%20const%20name=row.querySelector(%22.quickedit-vn%22)?.innerText.trim();%20const%20link=row.querySelector(%22a%22)?.href;%20const%20villageId=link?.match(/village=(\d+)/)?.[1];%20if(usedVillageIds.has(villageId))return;%20const%20coords=name?.match(/(\d+)\|(\d+)/);%20if(!coords)return;%20const[vx,vy]=coords.slice(1).map(Number);%20const%20distance=Math.round(Math.hypot(targetX-vx,targetY-vy));%20const%20wood=parseInt(row.querySelector('.wood')?.innerText.replace(/[^0-9]/g,'')||0);%20const%20clay=parseInt(row.querySelector('.stone')?.innerText.replace(/[^0-9]/g,'')||0);%20const%20iron=parseInt(row.querySelector('.iron')?.innerText.replace(/[^0-9]/g,'')||0);%20villageList.push({name,villageId,coords:[vx,vy],wood,clay,iron,distance});%20});%20%20const%20delay=1;%20let%20index=0;%20function%20fetchMarketDataSequentially(){%20if(index%3E=villageList.length){renderVillages(villageList);return;}%20const%20v=villageList[index];%20$.get(%60/game.php?village=${v.villageId}&screen=market%60,function(marketRes){%20const%20mDoc=new%20DOMParser().parseFromString(marketRes,%22text/html%22);%20const%20freeMerchants=parseInt(mDoc.querySelector('#market_merchant_available_count')?.textContent)||0;%20const%20packageVolume=pkgWood+pkgClay+pkgIron;%20const%20maxByResources=Math.floor(Math.min(v.wood/pkgWood,v.clay/pkgClay,v.iron/pkgIron));%20const%20maxByTraders=Math.floor((freeMerchants*1000)/packageVolume);%20v.maxFromVillage=Math.max(0,Math.min(maxByResources,maxByTraders));%20index++;%20setTimeout(fetchMarketDataSequentially,delay);%20});%20}%20fetchMarketDataSequentially();%20});%20}%20function%20renderVillages(villages){%20villages.sort((a,b)=%3Ea.distance-b.distance);%20const%20html=villages.map((v,i)=%3E{%20const%20id=%60sendBtn_${i}%60;%20const%20remaining=Math.max(0,maxPackages-sentPackages);%20const%20availableFromVillage=Math.max(0,Math.min(v.maxFromVillage||0,remaining));%20const%20opts=Array.from({length:availableFromVillage+1},(_,k)=%3E%60%3Coption%20value='${k}'%3E${k}%3C/option%3E%60).join('');%20return%60%3Cdiv%20id='row_${i}'%20style='border-bottom:1px%20solid%20#ccc;margin-bottom:4px;padding:4px'%3E%3Cb%3E${v.name}%3C/b%3E%20(${v.distance}%20mez%C5%91)%3Cbr%3EK%C3%A9szlet:%20%3Cimg%20src='https://dshu.innogamescdn.com/asset/7d3266bc/graphic/holz.webp'%20height=14%3E%20${v.wood.toLocaleString()}%20%3Cimg%20src='https://dshu.innogamescdn.com/asset/7d3266bc/graphic/lehm.webp'%20height=14%3E%20${v.clay.toLocaleString()}%20%3Cimg%20src='https://dshu.innogamescdn.com/asset/7d3266bc/graphic/eisen.webp'%20height=14%3E%20${v.iron.toLocaleString()}%3Cbr%3E%3Clabel%3ECsomag:%20%3Cselect%20id='pkgSel_${i}'%20data-max='${v.maxFromVillage}'%3E${opts}%3C/select%3E%3C/label%3E%20%3Cbutton%20id='${id}'%20class='btn'%3EK%C3%BCld%C3%A9s%3C/button%3E%3C/div%3E%60;%20}).join('');%20document.getElementById(%22villList%22).innerHTML=html;%20villages.forEach((v,i)=%3E{%20document.getElementById(%60sendBtn_${i}%60).onclick=function(){%20const%20count=parseInt(document.getElementById(%60pkgSel_${i}%60).value);%20if(count===0)return;%20$.get(%60/game.php?screen=api&ajax=target_selection&input=${coordinate}&type=coord%60,function(json){%20const%20data=typeof%20json==='string'?JSON.parse(json):json;%20if(!data.villages||data.villages.length===0)return%20alert(%22C%C3%A9l%20nem%20tal%C3%A1lhat%C3%B3!%22);%20const%20targetId=data.villages[0].id;%20TribalWars.post(%22market%22,{ajaxaction:%22map_send%22,village:v.villageId},{target_id:targetId,wood:pkgWood*count,stone:pkgClay*count,iron:pkgIron*count},function(res){%20UI.SuccessMessage(res.message);%20sentPackages+=count;%20usedVillageIds.add(v.villageId);%20document.getElementById('sentCounter').innerText=sentPackages;%20document.getElementById(%60row_${i}%60).remove();%20updateDropdowns();%20if(sentPackages%3E=maxPackages){document.querySelectorAll(%22button[id^='sendBtn_']%22).forEach(btn=%3Ebtn.disabled=true);}%20});});};});}%20function%20updateDropdowns(){const%20selects=document.querySelectorAll(%22select[id^='pkgSel_']%22);selects.forEach(select=%3E{const%20id=select.id.split('_')[1];const%20maxFromVillage=parseInt(select.dataset.max)||0;const%20remaining=Math.max(0,maxPackages-sentPackages);const%20available=Math.max(0,Math.min(maxFromVillage,remaining));const%20options=Array.from({length:available+1},(_,k)=%3E%60%3Coption%20value='${k}'%3E${k}%3C/option%3E%60).join('');select.innerHTML=options;});}%20fetchGroups();})();
